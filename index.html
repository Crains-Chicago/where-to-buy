---
layout: base
---

<div class="row">
  <div class="col-xs-12">
    <h1 class="title">
      <i class="fa fa-lg fa-home"></i> Where to Buy
      <small>Find the right Chicagoland real estate for you.</small>
    </h1>
    <hr />
  </div>
</div>

<div class="row">
  <div class="col-sm-10 col-sm-offset-1">
    <h3>Who's looking? <small>Choose a profile to view a set of pre-selected priorities.</small></h3>
    <div class="carousel">
      <div class="carousel-cell text-center" id="suburban-home">
        <span class="carousel-title"><strong>Suburban&nbsp;Family</strong></span>
        <br />
        <div class="row">
          <div class="col-xs-5 center-block">
            <table class="table profile-table">
              <tbody>
                <tr class="profile-tr">
                  <td><span class="small"><i class="fa fa-fw fa-arrow-up"></i></td>
                  <td><span class="small">schools</span></td>
                </tr>
                <tr class="profile-tr">
                  <td><span class="small"><i class="fa fa-fw fa-arrow-down"></i></td>
                  <td><span class="small">commute</span></td>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="carousel-cell carousel-selected selected text-center" id="city-home">
        <span class="carousel-title"><strong>City Family</strong></span>
        <br />
        <div class="row">
          <div class="col-xs-5 center-block">
            <table class="table profile-table">
              <tbody>
                <tr class="profile-tr">
                  <td><span class="small"><i class="fa fa-fw fa-arrow-up"></i></td>
                  <td><span class="small">diversity</span></td>
                </tr>
                <tr class="profile-tr">
                  <td><span class="small"><i class="fa fa-fw fa-arrow-down"></i></td>
                  <td><span class="small">price growth</span></td>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="carousel-cell text-center" id="downsized-home">
        <span class="carousel-title"><strong>Empty-nesters</strong></span>
        <br />
        <div class="row">
          <div class="col-xs-5 center-block">
            <table class="table profile-table">
              <tbody>
                <tr class="profile-tr">
                  <td><span class="small"><i class="fa fa-fw fa-arrow-up"></i></td>
                  <td><span class="small">price growth</span></td>
                </tr>
                <tr class="profile-tr">
                  <td><span class="small"><i class="fa fa-fw fa-arrow-down"></i></td>
                  <td><span class="small">schools</span></td>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="carousel-cell text-center" id="in-town">
        <span class="carousel-title"><strong>City Single</strong></span>
        <br />
        <div class="row">
          <div class="col-xs-5 center-block">
            <table class="table profile-table">
              <tbody>
                <tr class="profile-tr">
                  <td><span class="small"><i class="fa fa-fw fa-arrow-up"></i></td>
                  <td><span class="small">commute</span></td>
                </tr>
                <tr class="profile-tr">
                  <td><span class="small"><i class="fa fa-fw fa-arrow-down"></i></td>
                  <td><span class="small">schools</span></td>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="carousel-cell text-center" id="weekender">
        <span class="carousel-title"><strong>Weekenders</strong></span>
        <br />
        <div class="row">
          <div class="col-xs-5 center-block">
            <table class="table profile-table">
              <tbody>
                <tr class="profile-tr">
                  <td><span class="small"><i class="fa fa-fw fa-arrow-up"></i></td>
                  <td><span class="small">price growth</span></td>
                </tr>
                <tr class="profile-tr">
                  <td><span class="small"><i class="fa fa-fw fa-arrow-down"></i></td>
                  <td><span class="small">commute</span></td>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-md-4">
    <div class="text-center">
      <h3><span id="priority-title">My Priorities</span></h3>
      <p class="small help-block">Drag to change</p>
    </div>
    <div class="well" style="height:405px;">
      <div class="grid">
        <div class="grid-item text-center" id="diversity"><span class="badge pull-left"></span>
          <span class="priority">High Diversity</span>
        </div>
        <div class="grid-item text-center" id="schools"><span class="badge pull-left"></span>
          <span class="priority">Good Schools</span>
        </div>
        <div class="grid-item text-center" id="crime"><span class="badge pull-left"></span>
          <span class="priority">Low Crime</span>
        </div>
        <div class="grid-item text-center" id="price"><span class="badge pull-left"></span>
          <span class="priority">Solid Price </span>
          Growth</div>
        <div class="grid-item text-center" id="commute"><span class="badge pull-left"></span>
          <span class="priority">Short Commutes</span>
        </div>
      </div>
      <div id="price-range-control">
        <h4>
          <small style="font-family:'Lato',sans-serif;font-size:100%;color:#333333;line-height:1.3">
            <a title="What's this?" data-content="The price range reflects median home prices for each community. Set a range to filter out communities that don't match your needs." class="close" role="button" data-toggle="popover" data-trigger="hover" data-placement="auto" aria-label="Info">
              <span class="fa fa-info-circle"></span>
            </a>
          </small>
          Price range
          <small id="price-range-text">
            <span id="price-range-lower-bound"></span>
             &mdash; 
            <span id="price-range-upper-bound"></span>
          </small>
        </h4>
        <div id="price-range-slider"></div>
      </div>
    </div>
  </div>
  <div class="col-md-4" id="best-communities-div">
    <div class="text-center">
      <h3>Best Communities for You</h3>
      <p class="small help-block">Changing your priorities will update this list</p>
      <p class="small help-block mobile-users">
        <em><strong>Mobile users:</strong> Double-tap on a community name to see more information</em>
      </p>
      <div class="btn-group" role="group" style="margin-bottom:10px">
        <button type="button" class="btn btn-default geography-toggle active" id="chicago-toggle">Chicago</button>
        <button type="botton" class="btn btn-default geography-toggle" id="suburbs-toggle">Suburbs</button>
      </div>
    </div>
    <div class="table-responsive">
      <table class="table table-striped table-bordered table-hover" id="best-communities">
        <tbody>
          <tr>
            <td class="ranking">1. <span class="table-link" id="rank-1"></span></td>
          </tr>
          <tr>
            <td class="ranking">2. <span class="table-link" id="rank-2"></span></td>
          </tr>
          <tr>
            <td class="ranking">3. <span class="table-link" id="rank-3"></span></td>
          </tr>
          <tr>
            <td class="ranking">4. <span class="table-link" id="rank-4"></span></td>
          </tr>
          <tr>
            <td class="ranking">5. <span class="table-link" id="rank-5"></span></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div class="col-md-4">
    <div class="text-center">
      <form>
        <div class="form-group">
          <div class="col-xs-12">
            <div class="input-group" style="margin-top:10px">
              <input class="form-control input-lg search-text" id="search-address" placeholder="Set your work address (optional)" type="text" style="width:100%" />
              <div class="input-group-btn">
                <input class="btn btn-primary btn-lg" id="search-button" type="button" value="Search" />
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
    <div id="map"></div>
  </div>

</div>

<!-- Community information modal -->
<div class="modal fade" id="community-info" tabindex="-1" role="dialog" aria-labelledby="community-info-label"aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h2 class="modal-title" id="community-info-label">Community Information</h2>
      </div>
      <div class="modal-body">
        <div class="container-fluid">
          <div id="property-info">
            <div class="row">
              <div class="col-xs-12 col-md-5 pull-right">
                <div id="info-map"></div>
                <h4>About <span class="community-name">this community</span>:</h4>
                <p class="small" id="short-description"></p>
                <p class="small">
                  <a href="#" target="_blank" id="wikipedia-link">
                    Read more on Wikipedia <i class="fa fa-fw fa-arrow-right"></i>
                  </a>
                </p>
              </div>
              <div class="col-xs-12 col-md-7">
                <div class="row">
                  <h3><i class="fa fa-fw fa-bar-chart"></i> Community stats <small>See how <span class="community-name">this community</span> compares to other communities based on your priorities.</small></h3>
                  <table class="table">
                    <tbody>
                      <tr>
                        <td class='col-xs-6'>
                          <strong><i class='fa fa-fw fa-home'></i> Median home price</strong>
                          <a title="What's this?" data-content="The median home price for this area in 2016 as reported by the Chicago Association of Realtors." tabindex="0" class="chart-header close" role="button" data-toggle="popover" data-trigger="hover" data-placement="auto" aria-label="Info">
                            <span class="fa fa-info-circle" style="margin-right:20px;"></span>
                          </a>
                        </td>
                        <td class="price" id="median-price"></td>
                      </tr>
                      <tr>
                        <td class='col-xs-6'>
                          <strong><i class='fa fa-fw fa-car'></i> <span id="commute-type">Typical commute</span></strong>
                          <a title="What's this?" id="commute-info" data-content='We used US Census data to determine the average travel time for workers in this area.' tabindex="0" class="chart-header close" role="button" data-toggle="popover" data-trigger="hover" data-placement="auto" aria-label="Info">
                            <span class="fa fa-info-circle" style="margin-right:20px;"></span>
                          </a>
                        </td>
                        <td id="commute-score"></td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <div class="row">
                  <div class="table-responsive" style="margin-right:15px">
                    <table class="table table-bordered table-striped">
                      <tbody id="community-stats">
                        <tr class="stats-tr" id="diversity-row">
                          <td class='col-xs-6 col-sm-5' id="diversity-title">
                            <strong><i class='fa fa-fw fa-users'></i> Diversity</strong>
                            <a title="What's this?" data-content="We calculated the diversity score for this area using US Census demographic data and the Shannon index, which measures how easily we could guess a random resident's race if all we knew was the overall composition of the area." tabindex="0" class="chart-header close" role="button" data-toggle="popover" data-trigger="hover" data-placement="auto" aria-label="Info">
                              <span class="fa fa-info-circle" style="margin-right:20px;"></span>
                            </a>
                          </td>
                          <td class="sparkline diversity" id="diversity-score">
                          </td>
                        </tr>
                        <tr class="stats-tr" id="crime-row">
                          <td class='col-xs-6 col-sm-5' id="crime-title">
                            <strong><i class='fa fa-fw fa-balance-scale'></i> Crime</strong>
                            <a title="What's this?" data-content="We calculated crime scores using the 2015 Uniform Crime Report from the State of Illinois Police, which tracks a number of different kinds of violent crime across the state, as well as data from the City of Chicago." tabindex="0" class="chart-header close" role="button" data-toggle="popover" data-trigger="hover" data-placement="auto" aria-label="Info">
                              <span class="fa fa-info-circle" style="margin-right:20px;"></span>
                            </a>
                          </td>
                          <td class="sparkline crime" id="crime-score">
                          </td>
                        </tr>
                        <tr class="stats-tr" id="schools-row">
                          <td class='col-xs-6 col-sm-5' id="schools-title">
                            <strong><i class='fa fa-fw fa-graduation-cap'></i> Schools</strong>
                            <a title="What's this?" data-content="We calculated the school score for this area using 2015 data about test scores and teacher salaries from the School Report Card, a report published annually by the Illinois State Board of Education." tabindex="0" class="chart-header close" role="button" data-toggle="popover" data-trigger="hover" data-placement="auto" aria-label="Info">
                              <span class="fa fa-info-circle" style="margin-right:20px;"></span>
                            </a>
                          </td>
                          <td class="sparkline schools" id="schools-score">
                          </td>
                        </tr>
                        <tr class="stats-tr" id="price-row">
                          <td class='col-xs-6 col-sm-5' id="price-title">
                            <strong><i class='fa fa-fw fa-usd'></i> Price growth</strong>
                            <a title="What's this?" data-content="We calculated price growth scores for this area using the increase in home prices between 2015 and 2016, as reported by the Chicago Association of Realtors." tabindex="0" class="chart-header close" role="button" data-toggle="popover" data-trigger="hover" data-placement="auto" aria-label="Info">
                              <span class="fa fa-info-circle" style="margin-right:20px;"></span>
                            </a>
                          </td>
                          <td class="sparkline price" id="price-score">
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <button type="button" class="btn btn-default distribution-toggle">View charts as distributions</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- JS libs -->
<script src="assets/js/leaflet.js"></script>
<script src="assets/js/leaflet-google.js"></script>
<script src="assets/js/tether.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>
<script src="assets/js/draggabilly.pkgd.min.js"></script>
<script src="assets/js/packery.pkgd.min.js"></script>
<script src="assets/js/flickity.pkgd.min.js"></script>
<script src="assets/js/jquery.csv.min.js"></script>
<script src="assets/js/highcharts.js"></script>
<script src="assets/js/jquery-ui.min.js"></script>
<script src="assets/js/jquery.ui.touch-punch.js"></script>
<script src="assets/js/accounting.min.js"></script>

<!-- custom JS -->
<script src="assets/js/wheretobuy.js"></script>
<script>

  $(function() {
      // Initialize map and other goodies
      WhereToBuy.initialize();

      // Get the profile and priority widgets going
      var $carousel = $('.carousel').flickity({
                                        initialIndex: 1,
                                        wrapAround: true});
      var $grid = $('.grid').packery({
          isInitLayout: false,
          percentPosition: true,
          itemSelector: '.grid-item',
          gutter: 10,
      });

      // Get the price range slider going
      $('#price-range-slider').slider({
          min: WhereToBuy.priceMin,
          max: WhereToBuy.priceMax,
          step: 5000,
          range: true,
          values: [250000, 1750000],  // Default price range
          change: function(e, ui) {
              // Update price range text
              var $bound = ui.handleIndex == 1 ? $('#price-range-upper-bound') : $('#price-range-lower-bound');
              $bound.html(accounting.formatMoney(ui.value, {precision: 0}));
              // Trigger re-ranking of priorities
              WhereToBuy.priceRange[ui.handleIndex] = ui.value;
              WhereToBuy.displayRanking(WhereToBuy.rankCommunities());
          },
          create: function(e, ui) {
              // Set price range index
              var range = $('#price-range-slider').slider('values');
              $('#price-range-lower-bound').html(accounting.formatMoney(range[0], {precision: 0}));
              $('#price-range-upper-bound').html(accounting.formatMoney(range[1], {precision: 0}));
              // Trigger re-ranking of priorities
              WhereToBuy.priceRange = range;
          }
      });

      // Bind click and return events for the profile carousel
      function carouselHandler() {
          if ($(this).is('span')) {
              $el = $(this).parent('.carousel-cell');
          } else {  
              $el = $(this);
          }
          if (!$el.hasClass('carousel-selected')) {
              WhereToBuy.viewProfile($el.attr('id'));
              $('.carousel-cell').removeClass('carousel-selected selected');
              $el.addClass('carousel-selected selected');
          }
          // Update priority title
          var title = $el.find('.carousel-title strong').html();
          // Handle plurals
          title = (title.slice(-1) == 's') ? ('Priorities for ' + title) : ('Priorities for a ' + title);
          $('#priority-title').html(title);
      }

      function resetCarouselHandler() {
          // Rebind the carousel handler
          $('.carousel-cell, .carousel-title').on('click', carouselHandler);
          // Since this event handler is temporary, remove it at the end
          $grid.off('layoutComplete', resetCarouselHandler);
      }

      $('.carousel-cell, .carousel-title').on('click', carouselHandler);

      // Events for selecting a profile
      $grid.on('profileSelected', function() {
          // Temporarily disable carousel click events during animation
          $('.carousel-cell, .carousel-title').off('click', carouselHandler);
          $grid.on('layoutComplete', resetCarouselHandler);
          WhereToBuy.displayRanking(WhereToBuy.rankCommunities());
      })

      // Allow user to drag around priorities
      $('.grid-item').each(function(i, gridItem) {
          var drag = new Draggabilly(gridItem);
          $grid.packery('bindDraggabillyEvents', drag);
      });

      // Init priority order
      $grid.on('layoutComplete', function() {
          WhereToBuy.rankPriorities();
      });

      // When priorities get dragged around, recalculate top communities
      $grid.on('dragItemPositioned', function() {
          $('#priority-title').html('Custom Priorities');
          WhereToBuy.rankPriorities();
          WhereToBuy.displayRanking(WhereToBuy.rankCommunities());
      });

      // Trigger initial priority layout
      $grid.packery();

      // Define UX for the community rankings
      $('.ranking').on('click', function(e) {
          e.preventDefault();
          WhereToBuy.selectCommunity($(this).find('span').text());
      });

      // Init search address
      var autocomplete = new google.maps.places.Autocomplete(document.getElementById('search-address'));

      // Bind click and return events for the search bar
      $('#search-button').on('click', WhereToBuy.addressSearch);
      $('body').on('keypress', '#search-address', function(e) {
          if (e.keyCode == 13) {
              e.preventDefault();
              $('#search-button').click();
          }
      });

      // Bind click events for the geography toggle
      $('.geography-toggle').click(function(e) {
          $('.geography-toggle').removeClass('active');
          $(this).addClass('active');
          if ($(this).attr('id') == 'suburbs-toggle') {
              WhereToBuy.map.removeLayer(WhereToBuy.chicagoLayer);
              WhereToBuy.map.addLayer(WhereToBuy.suburbLayer);
              WhereToBuy.geography = 'suburbs';
              WhereToBuy.map.setView(WhereToBuy.mapCentroid, 8, {animate: true}); 
          } else {
              WhereToBuy.map.removeLayer(WhereToBuy.suburbLayer);
              WhereToBuy.map.addLayer(WhereToBuy.chicagoLayer);
              WhereToBuy.geography = 'chicago';
              WhereToBuy.map.setView(WhereToBuy.chicagoCentroid, 9, {animate: true}); 
          }
          WhereToBuy.rankPriorities();
          WhereToBuy.displayRanking(WhereToBuy.rankCommunities());
      });

      // Init popovers
      $("[data-toggle='popover']").popover();
  });

</script>