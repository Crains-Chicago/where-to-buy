---
layout: base
---

<div class="row">
  <div class="col-xs-12">
    <h1 class="title">
      <i class="fa fa-lg fa-home"></i> Where to Buy
      <small>Find the right Chicagoland real estate for you.</small>
    </h1>
    <hr />
  </div>
</div>

<div class="row">
  <div class="col-sm-10 col-sm-offset-1">
    <h3>Who's looking?</h3>
    <div class="carousel">
      <div class="carousel-cell text-center" id="suburban-home">
        <span class="carousel-title"><strong>Suburban&nbsp;Family</strong></span>
        <br /><span class="carousel-subtitle small"><i class="fa fa-fw fa-arrow-up"></i>schools</span>
        <br /><span class="carousel-subtitle small"><i class="fa fa-fw fa-arrow-down"></i>commute</span>
      </div>
      <div class="carousel-cell text-center" id="city-home">
        <span class="carousel-title"><strong>City Family</strong></span>
        <br /><span class="carousel-subtitle small"><i class="fa fa-fw fa-arrow-up"></i>diversity</span>
        <br /><span class="carousel-subtitle small"><i class="fa fa-fw fa-arrow-down"></i>price growth</span>
      </div>
      <div class="carousel-cell text-center" id="downsized-home">
        <span class="carousel-title"><strong>Empty-nesters</strong></span>
        <br /><span class="carousel-subtitle small"><i class="fa fa-fw fa-arrow-up"></i>price growth</span>
        <br /><span class="carousel-subtitle small"><i class="fa fa-fw fa-arrow-down"></i>schools</span>
      </div>
      <div class="carousel-cell text-center" id="in-town">
        <span class="carousel-title"><strong>Weekenders</strong></span>
        <br /><span class="carousel-subtitle small"><i class="fa fa-fw fa-arrow-up"></i>commute</span>
        <br /><span class="carousel-subtitle small"><i class="fa fa-fw fa-arrow-down"></i>schools</span>
      </div>
      <div class="carousel-cell text-center" id="vacation-home">
        <span class="carousel-title"><strong>Vacationers</strong></span>
        <br /><span class="carousel-subtitle small"><i class="fa fa-fw fa-arrow-up"></i>price growth</span>
        <br /><span class="carousel-subtitle small"><i class="fa fa-fw fa-arrow-down"></i>commute</span>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-md-4">
    <div class="text-center">
      <h3><span id="priority-title">My Priorities</span></h3>
      <p class="small help-block">Drag to change</p>
    </div>
    <div class="well" style="height:350px;">
      <div class="grid">
        <div class="grid-item text-center" id="diversity"><span class="badge pull-left"></span>
          <span class="priority">High Diversity</span>
        </div>
        <div class="grid-item text-center" id="schools"><span class="badge pull-left"></span>
          <span class="priority">Good Schools</span>
        </div>
        <div class="grid-item text-center" id="crime"><span class="badge pull-left"></span>
          <span class="priority">Low Crime</span>
        </div>
        <div class="grid-item text-center" id="price"><span class="badge pull-left"></span>
          <span class="priority">Solid Price </span>
          Growth</div>
        <div class="grid-item text-center" id="commute"><span class="badge pull-left"></span>
          <span class="priority">Short Commutes</span>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="text-center">
      <form>
        <div class="form-group">
          <div class="col-xs-12">
            <div class="input-group" style="margin-top:10px">
              <input class="form-control input-lg search-text" id="search-address" placeholder="Set your work address (optional)" type="text" style="width:100%" />
              <div class="input-group-btn">
                <input class="btn btn-primary btn-lg" id="search-button" type="button" value="Search" />
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
    <div id="map"></div>
  </div>
  <div class="col-md-4">
    <div class="text-center">
      <h3>Best Communities</h3>
      <p class="small help-block">Click to see more information</p>
      <div class="btn-group" role="group" style="margin-bottom:10px">
        <button type="button" class="btn btn-default geography-toggle" id="chicago-toggle">Chicago</button>
        <button type="botton" class="btn btn-default geography-toggle" id="suburbs-toggle">Suburbs</button>
        <button type="botton" class="btn btn-default geography-toggle active" id="both-toggle">Both</button>
      </div>
    </div>
    <div class="table-responsive">
      <table class="table table-striped table-bordered table-hover" id="best-communities">
        <tbody>
          <tr>
            <td class="ranking">1. <span id="rank-1"></span></td>
          </tr>
          <tr>
            <td class="ranking">2. <span id="rank-2"></span></td>
          </tr>
          <tr>
            <td class="ranking">3. <span id="rank-3"></span></td>
          </tr>
          <tr>
            <td class="ranking">4. <span id="rank-4"></span></td>
          </tr>
          <tr>
            <td class="ranking">5. <span id="rank-5"></span></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

</div>

<!-- Community information modal -->
<div class="modal fade" id="community-info" tabindex="-1" role="dialog" aria-labelledby="community-info-label"aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h2 class="modal-title" id="community-info-label">Community Information</h2>
      </div>
      <div class="modal-body">
        <div class="container-fluid">
          <div id="property-info">
            <div class="row">
              <div class="col-xs-12 col-md-4 pull-right">
                <div id="info-map"></div>
              </div>
              <div class="col-xs-12 col-md-8">
                <h4>From Wikipedia:</h4>
                <p class="small" id="short-description">
                </p>
              </div>
            </div>
            <br />
            <hr />
            <div class="row">
              <h3 style="margin-bottom: 20px;">Community stats
                <small>Hover for more information</small>
              </h3>
              <div class="table-responsive">
                <table class="table table-bordered table-striped">
                  <tbody id="community-stats">
                    <tr>
                      <td class='col-xs-4 text-left'>
                        <a title="What's this?" data-content="We calculated the diversity score for this area using US Census  data and the Shannon index, a measure of diversity that quantifies how easily we could guess a random resident's race if all we knew was the overall composition of the area." tabindex="0" class="chart-header pull-left" role="button" data-toggle="popover" data-trigger="hover" data-placement="auto" aria-label="Info">
                          <strong><i class='fa fa-fw fa-users'></i> Diversity score</strong>
                        </a>
                      </td>
                      <td class="chart-container">
                        <span class="bar-chart diversity" id="diversity-score">
                          <span class="tick min"></span>
                          <span class="tick firstQ"></span>
                          <span class="tick median"></span>
                          <span class="tick secondQ"></span>
                          <span class="tick max"></span>
                          <span class="bar"></span>
                        </span>
                      </td>
                    </tr>
                    <tr>
                      <td class='col-xs-4'><strong><i class='fa fa-fw fa-balance-scale'></i> Crime score</strong></td>
                      <td class="chart-container">
                        <span class="bar-chart crime" id="crime-score">
                          <span class="tick min"></span>
                          <span class="tick firstQ"></span>
                          <span class="tick median"></span>
                          <span class="tick secondQ"></span>
                          <span class="tick max"></span>
                          <span class="bar"></span>
                        </span>
                      </td>
                    </tr>
                    <tr>
                      <td class='col-xs-4'><strong><i class='fa fa-fw fa-graduation-cap'></i> School score</strong></td>
                      <td class="chart-container">
                        <span class="bar-chart schools" id="schools-score">
                          <span class="tick min"></span>
                          <span class="tick firstQ"></span>
                          <span class="tick median"></span>
                          <span class="tick secondQ"></span>
                          <span class="tick max"></span>
                          <span class="bar"></span>
                        </span>
                      </td>
                    </tr>
                    <tr>
                      <td class='col-xs-4'><strong><i class='fa fa-fw fa-usd'></i> Price score</strong></td>
                      <td class="price" id="price-score"></td>
                    </tr>
                    <tr>
                      <td class='col-xs-4'><strong><i class='fa fa-fw fa-car'></i> Typical commute</strong></td>
                      <td id="commute-score"></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="assets/js/leaflet.js"></script>
<script src="assets/js/leaflet-google.js"></script>
<script src="assets/js/tether.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>
<script src="assets/js/draggabilly.pkgd.min.js"></script>
<script src="assets/js/packery.pkgd.min.js"></script>
<script src="assets/js/flickity.pkgd.min.js"></script>
<script src="assets/js/jquery.csv.min.js"></script>
<script src="assets/js/wheretobuy.js"></script>
<script>

  $(function() {
      // Initialize map and other goodies
      WhereToBuy.initialize();

      // Get the profile and priority widgets going
      var $carousel = $('.carousel').flickity();
      var $grid = $('.grid').packery({
          isInitLayout: false,
          percentPosition: true,
          itemSelector: '.grid-item',
          gutter: 10,
      });

      // Allow user to drag around priorities
      $('.grid-item').each(function(i, gridItem) {
          var drag = new Draggabilly(gridItem);
          $grid.packery('bindDraggabillyEvents', drag);
      });

      // Init priority order
      $grid.on('layoutComplete', WhereToBuy.rankPriorities);

      // When priorities get reordered, recalculate top communities
      $grid.on('dragItemPositioned', function() {
          $('#priority-title').html('Custom Priorities');
          WhereToBuy.rankPriorities();
          WhereToBuy.displayRanking(WhereToBuy.rankCommunities());
      });

      $grid.on('profileSelected', function() {
          WhereToBuy.displayRanking(WhereToBuy.rankCommunities());
      })

      // Trigger initial priority layout
      $grid.packery();

      // Define UX for the community rankings
      $('.ranking').on('click', function() {
          WhereToBuy.selectCommunity($(this).children('span').text());
      });

      // Init search address
      var autocomplete = new google.maps.places.Autocomplete(document.getElementById('search-address'));

      // Bind click and return events for the search bar
      $('#search-button').on('click', WhereToBuy.addressSearch);
      $('body').on('keypress', '#search-address', function(e) {
          if (e.keyCode == 13) {
              e.preventDefault();
              $('#search-button').click();
          }
      });

      // Bind click and return events for the profile carousel
      $('.carousel-cell, .carousel-title').on('click', function(e) {
          // Handle event where the user clicks on the title
          if ($(this).is('span')) {
              $el = $(this).parent('.carousel-cell');
          } else {  
              $el = $(this);
          }
          if ($el.hasClass('carousel-selected')) {
              $el.removeClass('carousel-selected');
          } else {
              WhereToBuy.viewProfile($el.attr('id'));
              $('.carousel-cell').removeClass('carousel-selected, selected');
              $el.addClass('carousel-selected, selected');
          }
          // Update priority title
          var title = $el.find('.carousel-title').html();
          // Handle plurals
          title = (title.slice(-1) == 's') ? ('Priorities for ' + title) : ('Priorities for a ' + title);
          $('#priority-title').html(title);

      });

      // Bind click events for the geography toggle
      $('.geography-toggle').click(function(e) {
          $('.geography-toggle').removeClass('active');
          $(this).addClass('active');
          if ($(this).attr('id') == 'chicago-toggle') {
              WhereToBuy.map.removeLayer(WhereToBuy.suburbLayer);
              WhereToBuy.map.addLayer(WhereToBuy.chicagoLayer);
              WhereToBuy.geography = 'chicago';
              WhereToBuy.map.setView(WhereToBuy.chicagoCentroid, 9, {animate: true}); 
          } else if ($(this).attr('id') == 'suburbs-toggle') {
              WhereToBuy.map.removeLayer(WhereToBuy.chicagoLayer);
              WhereToBuy.map.addLayer(WhereToBuy.suburbLayer);
              WhereToBuy.geography = 'suburbs';
              WhereToBuy.map.setView(WhereToBuy.mapCentroid, 8, {animate: true}); 
          } else {
              WhereToBuy.map.addLayer(WhereToBuy.chicagoLayer);
              WhereToBuy.map.addLayer(WhereToBuy.suburbLayer);
              WhereToBuy.geography = 'both';
              WhereToBuy.map.setView(WhereToBuy.mapCentroid, 8, {animate: true}); 
          }
          WhereToBuy.rankPriorities();
          WhereToBuy.displayRanking(WhereToBuy.rankCommunities());
      });

      // Init popovers
      $("[data-toggle='popover']").popover();
  });

</script>